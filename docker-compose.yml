# =============================================================================
# CubeOS API â€” Local Development Compose
# =============================================================================
# For development/testing only. Production uses Swarm stack via coreapps.
#
# Usage: docker compose up -d
# =============================================================================
services:
  cubeos-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/cubeos-app/api:latest
    container_name: cubeos-api
    restart: unless-stopped
    user: root
    ports:
      - "${CUBEOS_API_BIND:-0.0.0.0}:6010:6010"
    environment:
      - CUBEOS_API_PORT=6010
      - CUBEOS_API_HOST=0.0.0.0
      - CUBEOS_LOG_LEVEL=debug
      - CUBEOS_DATABASE_PATH=/data/cubeos.db
      - CUBEOS_JWT_SECRET=${CUBEOS_JWT_SECRET:-dev-secret-change-me}
      - CUBEOS_ADMIN_PASSWORD=${CUBEOS_ADMIN_PASSWORD:-cubeos}
      - CUBEOS_ACCESS_TOKEN_EXPIRY=15m
      - CUBEOS_REFRESH_TOKEN_EXPIRY=168h
      - HAL_URL=http://cubeos-hal:6005
      - TZ=${TZ:-UTC}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - cubeos-data:/data
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:6010/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    labels:
      - "com.cubeos.service=api"
      - "com.cubeos.description=CubeOS Core API"

volumes:
  cubeos-data:
